# RAG æ£€ç´¢ä¼˜åŒ–ç­–ç•¥é›†åˆ

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æä¾›äº†ä¸€å¥—å®Œæ•´çš„RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿä¼˜åŒ–ç­–ç•¥ï¼Œé€šè¿‡å¤šç§ä¸åŒçš„æŠ€æœ¯æ–¹æ¡ˆæ¥æå‡æ£€ç´¢æ•ˆæœå’Œç­”æ¡ˆè´¨é‡ã€‚é¡¹ç›®åŒ…å«å››ç§æ ¸å¿ƒç­–ç•¥ï¼Œæ¯ç§ç­–ç•¥éƒ½é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ã€‚

## ğŸš€ æ ¸å¿ƒç­–ç•¥

### 1. Query Decomposition (æŸ¥è¯¢åˆ†è§£ç­–ç•¥)
- **æ ¸å¿ƒæ€æƒ³**: å°†å¤æ‚æŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªç®€å•çš„å­æŸ¥è¯¢ï¼Œå¹¶è¡Œå¤„ç†åæ•´åˆç»“æœ
- **é€‚ç”¨åœºæ™¯**: å¤æ‚å¤šç»´é—®é¢˜ã€æŠ€æœ¯æ¶æ„åˆ†æã€ç»¼åˆæ€§é—®é¢˜
- **ä¸»è¦ä¼˜åŠ¿**: 
  - æé«˜æ£€ç´¢ç²¾åº¦
  - å¢å¼ºç­”æ¡ˆå®Œæ•´æ€§ 
  - æå‡ç³»ç»Ÿé²æ£’æ€§
- **æ–‡æ¡£**: [æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£](query_decomposition/notes.md)

### 2. Refine (è¿­ä»£ä¼˜åŒ–ç­–ç•¥)
- **æ ¸å¿ƒæ€æƒ³**: é€šè¿‡å¤šè½®è¿­ä»£æ£€ç´¢ï¼Œé€æ­¥ç´¯ç§¯å’Œå®Œå–„ç­”æ¡ˆè´¨é‡
- **é€‚ç”¨åœºæ™¯**: çŸ¥è¯†å¯†é›†å‹æŸ¥è¯¢ã€å¯¹æ¯”åˆ†æç±»é—®é¢˜ã€éœ€è¦æ·±åº¦ä¿¡æ¯æ•´åˆçš„åœºæ™¯
- **ä¸»è¦ä¼˜åŠ¿**:
  - ä¿¡æ¯è¦†ç›–åº¦æå‡
  - ç­”æ¡ˆè´¨é‡æ¸è¿›ä¼˜åŒ–
  - è‡ªé€‚åº”æ£€ç´¢æ·±åº¦
- **æ–‡æ¡£**: [æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£](refine/notes.md)

### 3. Map-Reduce (åˆ†å¸ƒå¼å¤„ç†ç­–ç•¥)
- **æ ¸å¿ƒæ€æƒ³**: å°†å¤§è§„æ¨¡contextåˆ†å‰²æˆç‹¬ç«‹å—è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œç„¶åæ±‡æ€»æ•´åˆ
- **é€‚ç”¨åœºæ™¯**: å¤§é‡æ–‡æ¡£å¤„ç†ã€é«˜å¹¶å‘éœ€æ±‚ã€å¯¹å“åº”é€Ÿåº¦è¦æ±‚è¾ƒé«˜çš„åœºæ™¯
- **ä¸»è¦ä¼˜åŠ¿**:
  - æ˜¾è‘—çš„å¤„ç†é€Ÿåº¦æå‡ (4-8å€)
  - è‰¯å¥½çš„å¯æ‰©å±•æ€§
  - å……åˆ†åˆ©ç”¨è®¡ç®—èµ„æº
- **æ–‡æ¡£**: [æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£](map_reduce/notes.md)

### 4. HyDE (å‡è®¾æ€§æ–‡æ¡£åµŒå…¥ç­–ç•¥)
- **æ ¸å¿ƒæ€æƒ³**: å…ˆç”Ÿæˆå‡è®¾æ€§ç­”æ¡ˆï¼Œå†ç”¨è¯¥ç­”æ¡ˆè¿›è¡Œå‘é‡æ£€ç´¢ï¼Œæœ€ååŸºäºçœŸå®æ–‡æ¡£ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
- **é€‚ç”¨åœºæ™¯**: è¯­ä¹‰åŒ¹é…è¦æ±‚é«˜ã€ä¸“ä¸šé¢†åŸŸæŸ¥è¯¢ã€ç”¨æˆ·è¡¨è¾¾ä¸æ–‡æ¡£è¡¨è¾¾å·®å¼‚è¾ƒå¤§çš„åœºæ™¯
- **ä¸»è¦ä¼˜åŠ¿**:
  - æå‡æ£€ç´¢å¬å›ç‡
  - å¢å¼ºæ£€ç´¢ç²¾åº¦
  - æ”¹å–„è¯­ä¹‰åŒ¹é…æ•ˆæœ
- **æ–‡æ¡£**: [æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£](hyde/notes.md)

## ğŸ“Š ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | å¤„ç†é€Ÿåº¦ | ç­”æ¡ˆè´¨é‡ | å¯æ‰©å±•æ€§ | èµ„æºæ¶ˆè€— | å®ç°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|----------|------------|----------|
| **Query Decomposition** | â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­ | å¤æ‚é—®é¢˜åˆ†æ |
| **Refine** | â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­ | çŸ¥è¯†å¯†é›†å‹æŸ¥è¯¢ |
| **Map-Reduce** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­ | å¤§è§„æ¨¡æ–‡æ¡£å¤„ç† |
| **HyDE** | â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­ | è¯­ä¹‰æ£€ç´¢ä¼˜åŒ– |

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
rag-perf/
â”œâ”€â”€ query_decomposition/          # æŸ¥è¯¢åˆ†è§£ç­–ç•¥
â”‚   â”œâ”€â”€ runner.py                 # ç­–ç•¥æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ template.py               # Promptæ¨¡æ¿
â”‚   â”œâ”€â”€ notes.md                  # è¯¦ç»†æ–‡æ¡£
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ refine/                       # è¿­ä»£ä¼˜åŒ–ç­–ç•¥
â”‚   â”œâ”€â”€ runner.py                 # ç­–ç•¥æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ template.py               # Promptæ¨¡æ¿
â”‚   â”œâ”€â”€ notes.md                  # è¯¦ç»†æ–‡æ¡£
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ map_reduce/                   # åˆ†å¸ƒå¼å¤„ç†ç­–ç•¥
â”‚   â”œâ”€â”€ runner.py                 # ç­–ç•¥æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ template.py               # Promptæ¨¡æ¿
â”‚   â”œâ”€â”€ notes.md                  # è¯¦ç»†æ–‡æ¡£
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ hyde/                         # å‡è®¾æ€§æ–‡æ¡£åµŒå…¥ç­–ç•¥
â”‚   â”œâ”€â”€ runner.py                 # ç­–ç•¥æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ template.py               # Promptæ¨¡æ¿
â”‚   â”œâ”€â”€ notes.md                  # è¯¦ç»†æ–‡æ¡£
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```bash
Python 3.8+
asyncio
å…¶ä»–ä¾èµ–é¡¹ï¼ˆå…·ä½“æŸ¥çœ‹å„ç­–ç•¥æ–‡ä»¶å¤¹ï¼‰
```

### åŸºæœ¬é…ç½®

```python
# config.py
LLM_API_URL = "your-llm-api-url"
LLM_API_KEY = "your-api-key"
```

### ä½¿ç”¨ç¤ºä¾‹

#### 1. Query Decomposition ç­–ç•¥

```python
from query_decomposition.runner import QueryDecompositionRunner
from config import LLM_API_KEY, LLM_API_URL

runner = QueryDecompositionRunner(
    llm_api_key=LLM_API_KEY, 
    llm_api_url=LLM_API_URL
)

question = "å¦‚ä½•æ„å»ºé«˜æ€§èƒ½çš„å¾®æœåŠ¡ç›‘æ§ç³»ç»Ÿï¼Ÿ"
result = await runner.run_async(question, context_data)
```

#### 2. Refine ç­–ç•¥

```python
from refine.runner import RefineRunner

runner = RefineRunner(
    llm_api_key=LLM_API_KEY, 
    llm_api_url=LLM_API_URL
)

question = "åŒºå—é“¾æŠ€æœ¯åœ¨ä¾›åº”é“¾ç®¡ç†ä¸­çš„åº”ç”¨"
result = await runner.run_async(question, retrieval_func)
```

#### 3. Map-Reduce ç­–ç•¥

```python
from map_reduce.runner import LLMMapReduceRunner

runner = LLMMapReduceRunner(
    llm_api_key=LLM_API_KEY, 
    llm_api_url=LLM_API_URL
)

question = "ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“ï¼Œèƒ½ç”¨åœ¨å“ªäº›é¢†åŸŸï¼Ÿ"
result = await runner.run_async(question, knowledge_base, chunk_count=4)
```

#### 4. HyDE ç­–ç•¥

```python
from hyde.runner import HydeRunner

runner = HydeRunner(
    llm_api_key=LLM_API_KEY, 
    llm_api_url=LLM_API_URL
)

question = "ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“ï¼Ÿ"
result = await runner.run(question, retrieval_func, top_k=5)
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ£€ç´¢è´¨é‡æŒ‡æ ‡
- **ç²¾ç¡®ç‡ (Precision)**: æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§
- **å¬å›ç‡ (Recall)**: ç›¸å…³ä¿¡æ¯çš„è¦†ç›–åº¦  
- **F1åˆ†æ•°**: ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡

### ç­”æ¡ˆè´¨é‡æŒ‡æ ‡
- **å®Œæ•´æ€§**: ç­”æ¡ˆæ˜¯å¦å…¨é¢å›ç­”äº†åŸé—®é¢˜
- **å‡†ç¡®æ€§**: ç­”æ¡ˆä¿¡æ¯çš„æ­£ç¡®ç¨‹åº¦
- **è¿è´¯æ€§**: ç­”æ¡ˆçš„é€»è¾‘ç»“æ„æ˜¯å¦æ¸…æ™°

### æ•ˆç‡æŒ‡æ ‡
- **å“åº”æ—¶é—´**: ä»æŸ¥è¯¢åˆ°ç­”æ¡ˆçš„æ€»è€—æ—¶
- **è®¡ç®—æˆæœ¬**: å¤„ç†æŸ¥è¯¢æ‰€éœ€çš„è®¡ç®—èµ„æº
- **å¹¶è¡Œåº¦**: å¹¶è¡Œå¤„ç†æ•ˆç‡

## ğŸ¯ æœ€ä½³å®è·µ

### ç­–ç•¥é€‰æ‹©æŒ‡å—

1. **å¤§è§„æ¨¡æ–‡æ¡£å¤„ç†** â†’ ä¼˜å…ˆé€‰æ‹© **Map-Reduce**
2. **å¤æ‚å¤šç»´é—®é¢˜** â†’ æ¨èä½¿ç”¨ **Query Decomposition** 
3. **é«˜è´¨é‡ç­”æ¡ˆéœ€æ±‚** â†’ å»ºè®®é‡‡ç”¨ **Refine** ç­–ç•¥
4. **è¯­ä¹‰åŒ¹é…ä¼˜åŒ–** â†’ é€‚åˆä½¿ç”¨ **HyDE** ç­–ç•¥

### ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ç­–ç•¥**: å¯¹é‡å¤æŸ¥è¯¢å®æ–½ç¼“å­˜æœºåˆ¶
2. **å¹¶å‘æ§åˆ¶**: åˆç†è®¾ç½®å¹¶å‘æ•°é‡é¿å…APIé™æµ
3. **è´¨é‡ç›‘æ§**: å»ºç«‹ç­”æ¡ˆè´¨é‡è¯„ä¼°ä½“ç³»
4. **èµ„æºç®¡ç†**: ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### æ€§èƒ½è°ƒä¼˜

```python
# ç¤ºä¾‹ï¼šè‡ªé€‚åº”ç­–ç•¥é€‰æ‹©
def choose_strategy(question, context_size, quality_requirement):
    if context_size > 1000:
        return "map_reduce"
    elif quality_requirement == "high":
        return "refine" 
    elif "å¦‚ä½•" in question or "ä»€ä¹ˆæ˜¯" in question:
        return "query_decomposition"
    else:
        return "hyde"
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **å¼‚æ­¥å¤„ç†**: åŸºäº asyncio çš„å¹¶å‘å¤„ç†
- **æ¨¡æ¿å¼•æ“**: å¯é…ç½®çš„ Prompt æ¨¡æ¿ç³»ç»Ÿ
- **å‘é‡æ£€ç´¢**: æ”¯æŒå¤šç§å‘é‡æ•°æ®åº“
- **è´Ÿè½½å‡è¡¡**: æ™ºèƒ½çš„å¹¶å‘æ§åˆ¶æœºåˆ¶

### æ‰©å±•èƒ½åŠ›
- **è‡ªå®šä¹‰ç­–ç•¥**: æ”¯æŒè‡ªå®šä¹‰å®ç°æ–°çš„ç­–ç•¥
- **æ¨¡æ¿å®šåˆ¶**: å¯æ ¹æ®é¢†åŸŸéœ€æ±‚å®šåˆ¶ Prompt æ¨¡æ¿
- **æ’ä»¶æœºåˆ¶**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶æ‰©å±•
- **å¤šæ¨¡æ€æ”¯æŒ**: é¢„ç•™æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘çš„ç»¼åˆå¤„ç†æ¥å£

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- [Query Decomposition è¯¦ç»†è¯´æ˜](query_decomposition/notes.md)
- [Refine ç­–ç•¥æ–‡æ¡£](refine/notes.md)  
- [Map-Reduce æŠ€æœ¯æ–‡æ¡£](map_reduce/notes.md)
- [HyDE ä½¿ç”¨æŒ‡å—](hyde/notes.md)

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ Issue
- å‘é€é‚®ä»¶
- ç¤¾åŒºè®¨è®º

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼** 